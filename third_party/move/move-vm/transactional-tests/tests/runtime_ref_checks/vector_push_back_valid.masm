//# publish
module 0xc0ffee::vec_push_test

// Test: VecPushBack should work and NOT poison existing element references
// (per line 1733-1735 in runtime_ref_checks.rs)
public fun test_vec_push_back_no_poison(): u64
    local vec: vector<u64>
    local elem_ref: &u64
    local vec_ref: &mut vector<u64>

    // Create vector with 1 element
    ld_u64 100
    vec_pack<u64> 1
    st_loc vec

    // Get reference to the first element
    mut_borrow_loc vec
    ld_u64 0
    vec_borrow<u64>
    st_loc elem_ref

    // Get mutable reference to vector
    mut_borrow_loc vec
    st_loc vec_ref

    // Push back new element (should NOT poison elem_ref)
    move_loc vec_ref
    ld_u64 200
    vec_push_back<u64>

    // Read from elem_ref should still work
    move_loc elem_ref
    read_ref
    ret

//# run 0xc0ffee::vec_push_test::test_vec_push_back_no_poison --verbose
