//# publish
module 0x1::Token
use 0x1::signer
struct T has key
  count: u64

public fun test(l0: &signer) acquires T
    local l1: &mut T
    local l2: &mut u64
    local l3: u64
    local l4: &mut u64
    local l5: address
    copy_loc l0
    ld_u64 0
    pack T
    move_to T
    move_loc l0
    call signer::address_of
    st_loc l5
    move_loc l5
    mut_borrow_global T
    st_loc l1
    move_loc l1
    mut_borrow_field T, count
    st_loc l2
    ld_u64 0
    st_loc l3
    mut_borrow_loc l3
    st_loc l4
    move_loc l2
    move_loc l4
    eq
    not
    br_false l0
    ld_u64 42
    abort
l0: ret



//# run --signers 0x1
script
use 0x1::Token
entry public fun main(l0: signer)
    borrow_loc l0
    call Token::test
    ret
