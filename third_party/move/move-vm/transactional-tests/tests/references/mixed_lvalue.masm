//# publish
module 0x1::A
struct S
  f: u64

fun four(): (u64, u64, u64, u64)
    ld_u64 0
    ld_u64 1
    ld_u64 2
    ld_u64 3
    ret

public fun mixed()
    local l0: u64
    local l1: u64
    local l2: &mut u64
    local l3: S
    ld_u64 0
    st_loc l1
    mut_borrow_loc l1
    st_loc l2
    ld_u64 0
    pack S
    st_loc l3
    call four
    mut_borrow_loc l3
    mut_borrow_field S, f
    write_ref
    copy_loc l2
    write_ref
    st_loc l0
    pop
    move_loc l0
    ld_u64 1
    eq
    not
    br_false l0
    ld_u64 42
    abort
l0: copy_loc l2
    read_ref
    ld_u64 2
    eq
    not
    br_false l1
    ld_u64 42
    abort
l1: borrow_loc l3
    borrow_field S, f
    read_ref
    ld_u64 3
    eq
    not
    br_false l2
    ld_u64 42
    abort
l2: call four
    copy_loc l2
    write_ref
    st_loc l0
    pop
    mut_borrow_loc l3
    mut_borrow_field S, f
    write_ref
    move_loc l0
    ld_u64 2
    eq
    not
    br_false l3
    ld_u64 42
    abort
l3: copy_loc l2
    read_ref
    ld_u64 3
    eq
    not
    br_false l4
    ld_u64 42
    abort
l4: borrow_loc l3
    borrow_field S, f
    read_ref
    ld_u64 0
    eq
    not
    br_false l5
    ld_u64 42
    abort
l5: call four
    st_loc l0
    pop
    mut_borrow_loc l3
    mut_borrow_field S, f
    write_ref
    copy_loc l2
    write_ref
    move_loc l0
    ld_u64 3
    eq
    not
    br_false l6
    ld_u64 42
    abort
l6: copy_loc l2
    read_ref
    ld_u64 0
    eq
    not
    br_false l7
    ld_u64 42
    abort
l7: borrow_loc l3
    borrow_field S, f
    read_ref
    ld_u64 1
    eq
    not
    br_false l8
    ld_u64 42
    abort
l8: call four
    pop
    mut_borrow_loc l3
    mut_borrow_field S, f
    write_ref
    copy_loc l2
    write_ref
    st_loc l0
    move_loc l0
    ld_u64 0
    eq
    not
    br_false l9
    ld_u64 42
    abort
l9: move_loc l2
    read_ref
    ld_u64 1
    eq
    not
    br_false l10
    ld_u64 42
    abort
l10: borrow_loc l3
    borrow_field S, f
    read_ref
    ld_u64 2
    eq
    not
    br_false l11
    ld_u64 42
    abort
l11: move_loc l3
    unpack S
    st_loc l1
    ret



//# run
script
use 0x1::A
entry public fun main()
    call A::mixed
    ret
