//# publish
module 0x42::m
struct S has copy + drop
  f: u64

public fun foo()
    local l0: S
    local l1: S
    local l2: u64
    local l3: &S
    local l4: &u64
    ld_u64 0
    pack S
    st_loc l0
    ld_u64 0
    st_loc l2
    borrow_loc l0
    st_loc l3
    borrow_loc l2
    st_loc l4
l0: ld_u64 1
    pack S
    st_loc l1
    copy_loc l3
    read_ref
    pop
    borrow_loc l1
    st_loc l3
    copy_loc l3
    borrow_field S, f
    st_loc l4
    branch l0



//# run 0x42::m::foo --gas-budget 100000

//# run --gas-budget 100000
script
entry public fun main()
    local l0: u64
    local l1: u64
    local l2: u64
    local l3: &u64
    ld_u64 0
    st_loc l0
    borrow_loc l0
    st_loc l3
l0: ld_u64 0
    st_loc l1
    copy_loc l3
    read_ref
    st_loc l2
    borrow_loc l1
    st_loc l3
    branch l0
