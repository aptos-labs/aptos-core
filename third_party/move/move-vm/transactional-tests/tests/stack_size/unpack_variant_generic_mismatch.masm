//# publish
module 0x3::trusted

enum A<T>
    V1
        x: T
    V2
        x: T
        y: T
    V3
        x: T
        y: T
        z: T

public fun pack_v2_unpack_v2(): u64
    ld_u64 20
    ld_u64 30
    pack_variant A<u64>, V2
    unpack_variant A<u64>, V2
    pop
    ret

public fun pack_v2_unpack_v1(): u64
    ld_u64 20
    ld_u64 30
    pack_variant A<u64>, V2
    unpack_variant A<u64>, V1
    ret

public fun pack_v2_unpack_v3(): u64
    ld_u64 20
    ld_u64 30
    pack_variant A<u64>, V2
    unpack_variant A<u64>, V3
    pop
    pop
    ret

//# run --verbose 0x3::trusted::pack_v2_unpack_v2

//# run --verbose 0x3::trusted::pack_v2_unpack_v1

//# run --verbose 0x3::trusted::pack_v2_unpack_v3

//# publish
module 0x4::trusted

enum A<T>
    V1
        x: T
    V2
        x: T
        y: T
    V3
        x: T
        y: T
        z: T

enum B<T>
    V1
        x: T
        y: T
    V2
        x: T
        y: T
    V3
        x: T
        y: T

public fun pack_a_v1_unpack_b_v1(): u64
    ld_u64 20
    pack_variant A<u64>, V1
    unpack_variant B<u64>, V1
    pop
    ret

public fun pack_a_v2_unpack_b_v2(): u64
    ld_u64 20
    ld_u64 30
    pack_variant A<u64>, V2
    // Succeeds: stack is balanced even though type is wrong.
    unpack_variant B<u64>, V2
    pop
    ret

public fun pack_a_v3_unpack_b_v3(): u64
   ld_u64 20
   ld_u64 30
   ld_u64 40
   pack_variant A<u64>, V3
   unpack_variant B<u64>, V3
   pop
   ret

public fun pack_a_v3_unpack_b_v2(): u64
   ld_u64 20
   ld_u64 30
   ld_u64 40
   pack_variant A<u64>, V3
   unpack_variant B<u64>, V2
   pop
   ret

//# run --verbose 0x4::trusted::pack_a_v1_unpack_b_v1

//# run --verbose 0x4::trusted::pack_a_v2_unpack_b_v2

//# run --verbose 0x4::trusted::pack_a_v3_unpack_b_v3

//# run --verbose 0x4::trusted::pack_a_v3_unpack_b_v2
