// ========= Field Type

{% for ty1 in ["u64", "&u8"] %}

{% set suffix = mangle(repr=ty1) %}

//# publish
module 0x66::incompatible_field_type_{{suffix}}
struct A has drop
    x: |{{ty1}}|u32 has drop


{% for ty2 in ["u16", "address", "&mut u8"] %}

{% if ty1 != ty2 %}

//# publish --verbose
module 0x66::incompatible_field_type_{{suffix}}
struct A has drop
    x: |{{ty2}}|u32 has drop


//# publish --verbose
module 0x66::incompatible_field_type_{{suffix}}
struct A has drop
    x: |{{ty1}}|{{ty2}} has drop

{% endif %}
{% endfor %}
{% endfor %}


// ========= Field Ability

{% for abi_old in [ "has drop", "has copy+drop", ""] %}

{% set suffix = mangle(repr=abi_old) %}

//# publish
module 0x66::incompatible_field_ability_{{suffix}}
struct A
    x: |u64|u32 {{abi_old}}


{% for abi_new in [ "has copy", "has copy+store", ""] %}

{% if abi_new != abi_old %}

//# publish --verbose
module 0x66::incompatible_field_ability_{{suffix}}
struct A
    x: |u64|u32 {{abi_new}}

{% endif %}
{% endfor %}
{% endfor %}

// ========= Function Type

//# publish
module 0x66::compatible_function_since_private
fun foo(x: |u64|u32)

//# publish
module 0x66::compatible_function_since_private
fun foo(x: |bool|u32)

//# publish
module 0x66::incompatible_function_since_persistent
#[persistent] fun foo(x: |u64|u32)

//# publish --verbose
module 0x66::incompatible_function_since_persistent
#[persistent] fun foo(x: |bool|u32)

//# publish
module 0x66::incompatible_function_since_public
public fun foo(x: |u64|u32)

//# publish --verbose
module 0x66::incompatible_function_since_public
public fun foo(x: |bool|u32)

//# publish
module 0x66::incompatible_function_result_since_public
public fun foo(): |u64|u32

//# publish --verbose
module 0x66::incompatible_function_result_since_public
public fun foo(): |bool|u32

// ========= Function Ability

//# publish
module 0x66::incompatible_function_ability_since_public
public fun foo(): |u64|u32 has store

//# publish --verbose
module 0x66::incompatible_function_ability_since_public
public fun foo(): |bool|u32 has copy+store

//# publish --verbose
module 0x66::incompatible_function_ability2_since_public
public fun foo(): |u64|u32 has store+copy

//# publish --verbose
module 0x66::incompatible_function_ability2_since_public
public fun foo(): |bool|u32 has copy

// ======= Generics

//# publish
module 0x66::incompatible_generic_function
public fun foo<A>(): |A|A

//# publish --verbose
module 0x66::incompatible_generic_function
public fun foo<A>(): |A|u32

//# publish --verbose
module 0x66::incompatible_generic_function
public fun foo<A, B>(): |A|B

//# publish
module 0x66::incompatible_generic_structure
struct S<A>
    x: A
public fun foo<A>(): |S<A>|A

//# publish --verbose
module 0x66::incompatible_generic_structure
struct S<A>
    x: A
public fun foo<A, B>(): |S<B>|A
