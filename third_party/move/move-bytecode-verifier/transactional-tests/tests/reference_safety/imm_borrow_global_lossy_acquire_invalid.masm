//# publish
module 0x1::A
struct Coin has store
  u: u64

public fun new(): Coin
    ld_u64 1
    pack Coin
    ret

public fun join(l0: Coin, l1: Coin): Coin
    local l2: u64
    local l3: u64
    move_loc l0
    unpack Coin
    st_loc l2
    move_loc l1
    unpack Coin
    st_loc l3
    move_loc l2
    move_loc l3
    add
    pack Coin
    ret

public fun split(l0: Coin, l1: u64): (Coin, Coin)
    local l2: u64
    local l3: u64
    move_loc l0
    unpack Coin
    st_loc l2
    copy_loc l2
    copy_loc l1
    ge
    not
    br_false l0
    ld_u64 42
    abort
l0: move_loc l2
    copy_loc l1
    sub
    st_loc l2
    copy_loc l1
    st_loc l3
    move_loc l2
    pack Coin
    move_loc l3
    pack Coin
    ret



//# publish
module 0x1::Tester
use 0x1::A
struct Pair has key
  x: A::Coin
  y: A::Coin

fun test_eq(l0: address, l1: address): bool acquires Pair
    local l2: &Pair
    move_loc l0
    borrow_global Pair
    st_loc l2
    move_loc l2
    move_loc l1
    call eq_helper
    ret

fun eq_helper(l0: &Pair, l1: address): bool acquires Pair
    local l2: &Pair
    move_loc l1
    borrow_global Pair
    st_loc l2
    move_loc l0
    move_loc l2
    eq
    ret