[net]
retry = 3                 # network retries
git-fetch-with-cli = true # use the `git` executable for git operations

[alias]
xclippy = [
  "clippy",
  "--workspace",
  "--all-targets",
  "--",
  "-Dwarnings",
  "-Wclippy::all",
  "-Aclippy::upper_case_acronyms",
  "-Aclippy::enum-variant-names",
  "-Aclippy::result-large-err",
  "-Aclippy::mutable-key-type",
  "-Aclippy::map_identity",        # We temporarily ignore this due to: https://github.com/rust-lang/rust-clippy/issues/11764
]
x = "run --package aptos-cargo-cli --bin aptos-cargo-cli --"

[build]
rustflags = [
  "--cfg",
  "tokio_unstable",
  "-C",
  "force-frame-pointers=yes",
  "-C",
  "force-unwind-tables=yes",
]

# TODO(grao): Figure out whether we should enable othaer cpu features, and whether we should use a different way to configure them rather than list every single one here.
[target.x86_64-unknown-linux-gnu]
rustflags = [
  "--cfg",
  "tokio_unstable",
  "-C",
  "linker=clang",
  "-C",
  "link-arg=-fuse-ld=lld",
  "-C",
  "force-frame-pointers=yes",
  "-C",
  "force-unwind-tables=yes",
  "-C",
  "target-feature=+sse4.2",
]

# 64 bit MSVC
[target.x86_64-pc-windows-msvc]
rustflags = [
  "--cfg",
  "tokio_unstable",
  "-C",
  "force-frame-pointers=yes",
  "-C",
  "force-unwind-tables=yes",
  "-C",
  "link-arg=/STACK:8000000",  # Set stack to 8 MB
]

[env]
CMAKE_POLICY_VERSION_MINIMUM = "3.5"
CXXFLAGS = "-include cstdint"        # Needed for `librocksdb-sys` build
